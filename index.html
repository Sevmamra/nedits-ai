<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nedits AI — Professional Assistant</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
    /* ------------------- */
    /* 1. Global Styles & Theme Variables */
    /* ------------------- */
    :root {
        --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
        --bg: #111827;
        --panel: #1f2937;
        --sidebar: #111827;
        --muted: #9ca3af;
        --text: #f9fafb;
        --accent: #8b5cf6;
        --accent-hover: #7c3aed;
        --danger: #ef4444;
        --border-color: rgba(255, 255, 255, 0.08);
        --user-bubble: linear-gradient(160deg, rgba(139, 92, 246, .15), rgba(139, 92, 246, .05));
        --ai-bubble: #374151;
        --shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }

    [data-theme="light"] {
        --bg: #f9fafb;
        --panel: #ffffff;
        --sidebar: #f3f4f6;
        --muted: #4b5563;
        --text: #111827;
        --border-color: rgba(0, 0, 0, 0.08);
        --user-bubble: linear-gradient(160deg, rgba(139, 92, 246, .1), rgba(139, 92, 246, .03));
        --ai-bubble: #f3f4f6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body, html {
        height: 100%;
        overflow: hidden;
    }

    body {
        font-family: var(--font-sans);
        background: var(--bg);
        color: var(--text);
        display: flex;
    }

    /* ------------------- */
    /* 2. Main Layout */
    /* ------------------- */
    .app-container { display: flex; width: 100%; height: 100%; }

    .sidebar {
        width: 260px;
        background: var(--sidebar);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        padding: 16px;
        transition: transform 0.3s ease-in-out;
        flex-shrink: 0;
        z-index: 100;
    }

    .chat-panel {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
        position: relative;
    }
    
    .mobile-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 99;
    }

    /* ------------------- */
    /* 3. Sidebar Components */
    /* ------------------- */
    .sidebar-header {
        display: flex; align-items: center; gap: 12px;
        padding-bottom: 16px; margin-bottom: 16px;
        border-bottom: 1px solid var(--border-color);
    }
    .logo {
    width: 36px; height: 36px; border-radius: 8px;
    background-image: url('https://raw.githubusercontent.com/Sevmamra/nedits-ai/main/logo/logo.png');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    }
    .brand-name { font-weight: 600; font-size: 18px; }

    .new-chat-btn {
        width: 100%; text-align: left; padding: 10px 12px;
        border: 1px solid var(--border-color);
        background: transparent; color: var(--text);
        border-radius: 8px; font-size: 14px;
        cursor: pointer; display: flex; align-items: center; gap: 10px;
        transition: background 0.2s ease;
    }
    .new-chat-btn:hover { background: rgba(255, 255, 255, 0.05); }
    [data-theme="light"] .new-chat-btn:hover { background: rgba(0, 0, 0, 0.05); }

    .chat-history { flex-grow: 1; overflow-y: auto; margin-top: 16px; }
    .chat-history-item {
        display: flex; align-items: center; justify-content: space-between;
        padding: 10px 12px; border-radius: 6px;
        cursor: pointer; font-size: 14px; color: var(--muted);
        margin-bottom: 4px;
    }
    .chat-history-item:hover { background: var(--panel); color: var(--text); }
    .chat-history-item.active { background: var(--accent); color: white; }
    .chat-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .delete-chat-btn {
        background: none; border: none; color: var(--muted);
        cursor: pointer; font-size: 14px;
        opacity: 0; transition: opacity 0.2s;
        padding: 4px;
    }
    .chat-history-item:hover .delete-chat-btn { opacity: 1; }
    .delete-chat-btn:hover { color: var(--danger); }
    .chat-history-item.active .delete-chat-btn { color: rgba(255,255,255,0.7); }
    .chat-history-item.active .delete-chat-btn:hover { color: white; }

    /* ------------------- */
    /* 4. Main Chat Panel Components */
    /* ------------------- */
    .chat-header {
        padding: 12px 20px;
        display: flex; align-items: center; justify-content: flex-end;
        border-bottom: 1px solid var(--border-color);
        background: rgba(17, 24, 39, 0.5); backdrop-filter: blur(8px);
        position: absolute; top: 0; left: 0; width: 100%;
        z-index: 10;
    }
    [data-theme="light"] .chat-header { background: rgba(249, 250, 251, 0.5); }
    
    .icon-btn {
        width: 36px; height: 36px;
        background: transparent; border: 1px solid var(--border-color);
        color: var(--text); border-radius: 50%;
        cursor: pointer; display: grid; place-items: center;
        transition: background 0.2s ease;
    }
    .icon-btn:hover { background: var(--panel); }
    #menu-btn { display: none; }

    /* *** LAYOUT FIX: THIS IS THE KEY *** */
    .chat-container {
        flex-grow: 1;
        overflow-y: auto;
        padding-top: 70px; /* Space for header */
    }
    .message-list {
        max-width: 800px; margin: 0 auto; width: 100%;
        padding: 20px;
    }
    
    .empty-state {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        height: 100%; text-align: center; padding-bottom: 100px;
    }
    .empty-state .logo { width: 60px; height: 60px; font-size: 32px; border-radius: 12px; margin-bottom: 16px; }
    .empty-state h1 { font-size: 24px; margin-bottom: 8px; }
    
    .prompt-suggestions { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-top: 24px; }
    .suggestion-card {
        background: var(--panel);
        border: 1px solid var(--border-color);
        padding: 12px; border-radius: 8px;
        cursor: pointer; font-size: 14px;
        transition: background 0.2s ease;
    }
    .suggestion-card:hover { background: var(--ai-bubble); }

    .bubble { display: flex; gap: 16px; margin-bottom: 24px; }
    .bubble.user { justify-content: flex-end; }
    
    .avatar { width: 36px; height: 36px; border-radius: 8px; display: grid; place-items: center; font-weight: 600; flex-shrink: 0; }
    .avatar.ai {
    background-image: url('https://raw.githubusercontent.com/Sevmamra/nedits-ai/logo.png');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    background-color: transparent; /* पुराना रंग हटाने के लिए */
}
    .avatar.user { background: var(--panel); border: 1px solid var(--border-color); }
    
    .msg { padding: 12px 16px; border-radius: 12px; max-width: 90%; line-height: 1.6; }
    .bubble.ai .msg { background: var(--ai-bubble); }
    .bubble.user .msg { background: var(--user-bubble); }

    .msg p:last-child { margin-bottom: 0; }
    .msg ul, .msg ol { margin: 0.5em 0 1em 1.5em; }
    
    .msg pre {
        background-color: #0d1117 !important;
        padding: 1em; border-radius: 8px;
        margin: 1em 0; overflow-x: auto;
        border: 1px solid var(--border-color);
    }

    .composer-container {
        padding: 16px;
        border-top: 1px solid var(--border-color);
        background: var(--bg);
        flex-shrink: 0;
    }
    .composer {
        max-width: 800px; margin: 0 auto;
        display: flex; align-items: flex-end; gap: 10px;
        padding: 8px; border-radius: 12px;
        background: var(--panel); border: 1px solid var(--border-color);
    }
    #input {
        flex-grow: 1; border: none; background: transparent;
        color: var(--text); font-size: 16px;
        resize: none; max-height: 200px; outline: none;
        line-height: 2.5;
    }
    #sendBtn {
        width: 38px; height: 38px;
        background: var(--accent); color: white;
        border: none; border-radius: 8px;
        cursor: pointer; display: grid; place-items: center;
        transition: background 0.2s ease;
        flex-shrink: 0;
    }
    #sendBtn:hover { background: var(--accent-hover); }
    #sendBtn:disabled { background: var(--muted); cursor: not-allowed; }

    /* ------------------- */
    /* 5. Responsive Design */
    /* ------------------- */
    @media (max-width: 768px) {
        .sidebar {
            position: fixed;
            height: 100%;
            transform: translateX(-100%);
            box-shadow: var(--shadow);
        }
        .sidebar.open { transform: translateX(0); }
        #menu-btn { display: grid; }
        .chat-header { justify-content: space-between; }
        .message-list { padding: 12px; }
        .composer-container { padding: 12px; }
        .mobile-overlay.active { display: block; }
    }
</style>
</head>
<body>

<div class="app-container">
    <div class="mobile-overlay" id="mobile-overlay"></div>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"></div>
            <span class="brand-name">Nedits AI</span>
        </div>
        <button class="new-chat-btn" id="new-chat-btn">
            <i class="fa-solid fa-plus"></i>
            <span>New Chat</span>
        </button>
        <div class="chat-history" id="chat-history"></div>
    </aside>

    <main class="chat-panel" id="chat-panel">
        <header class="chat-header">
            <button class="icon-btn" id="menu-btn"><i class="fa-solid fa-bars"></i></button>
            <button class="icon-btn" id="theme-toggle"><i class="fa-solid fa-moon"></i></button>
        </header>

        <div class="chat-container" id="chat-container">
            <div class="message-list" id="message-list">
                <div class="empty-state" id="empty-state">
                    <div class="logo"></div>
                    <h1>Nedits AI</h1>
                    <p>Your official assistant. How can I help you today?</p>
                    <div class="prompt-suggestions">
                        <div class="suggestion-card" data-prompt="Explain all services of Nedits Edition in detail.">Explain your services</div>
                        <div class="suggestion-card" data-prompt="Write a marketing slogan for a video editing service.">Write a marketing slogan</div>
                        <div class="suggestion-card" data-prompt="Give me ideas for a new tech startup.">Ideas for a tech startup</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="composer-container">
            <div class="composer">
                <textarea id="input" placeholder="Ask Nedits AI anything..." rows="1"></textarea>
                <button id="sendBtn"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // CONFIGURATION & API DETAILS
    const API_KEY = "AIzaSyDYe_vdjBBjyXjgs1vB2_UGpjrmaomj2TE"; // YOUR REAL KEY HERE
    const MODEL_NAME = "gemini-1.5-flash-latest";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:streamGenerateContent?alt=sse`;
    const SYSTEM_PROMPT = `## 1. Core Identity & Mission...`; // Your full, amazing prompt goes here

    // DOM ELEMENT REFERENCES
    const sidebar = document.getElementById('sidebar');
    const menuBtn = document.getElementById('menu-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const newChatBtn = document.getElementById('new-chat-btn');
    const chatHistoryEl = document.getElementById('chat-history');
    const messageListEl = document.getElementById('message-list');
    const emptyStateEl = document.getElementById('empty-state');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const suggestionCards = document.querySelectorAll('.suggestion-card');
    const mobileOverlay = document.getElementById('mobile-overlay');
    const chatPanel = document.getElementById('chat-panel');

    // STATE MANAGEMENT
    let chats = {};
    let activeChatId = null;

    function saveState() { /* ... same as before ... */ }
    function loadState() { /* ... same as before ... */ }

    // Reworked renderSidebar function to include delete button
    function renderSidebar() {
        chatHistoryEl.innerHTML = '';
        const sortedChatIds = Object.keys(chats).sort((a, b) => b - a);

        sortedChatIds.forEach(chatId => {
            const chat = chats[chatId];
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-history-item';
            chatItem.dataset.chatId = chatId;

            const title = document.createElement('span');
            title.className = 'chat-title';
            title.textContent = chat.title;

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-chat-btn';
            deleteBtn.innerHTML = '<i class="fa-solid fa-trash-can"></i>';
            deleteBtn.dataset.chatId = chatId;

            chatItem.appendChild(title);
            chatItem.appendChild(deleteBtn);

            if (chatId === activeChatId) {
                chatItem.classList.add('active');
            }
            chatHistoryEl.appendChild(chatItem);
        });
    }

    function renderActiveChat() { /* ... same as before ... */ }
    function addBubble(role, content) { /* ... same as before ... */ }

    // NEW function to handle deleting a chat
    function deleteChat(chatIdToDelete) {
        if (confirm('Are you sure you want to delete this chat history?')) {
            delete chats[chatIdToDelete];
            
            if (activeChatId === chatIdToDelete) {
                // If the active chat is deleted, start a new one
                const remainingChats = Object.keys(chats).sort((a,b) => b-a);
                if(remainingChats.length > 0) {
                    switchChat(remainingChats[0]);
                } else {
                    startNewChat();
                }
            }
            saveState();
            renderSidebar();
        }
    }

    function startNewChat() { /* ... same as before ... */ }
    function switchChat(chatId) { /* ... same as before, with one change ... */ 
        activeChatId = chatId;
        renderActiveChat();
        renderSidebar();
        saveState();
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('open');
            mobileOverlay.classList.remove('active');
        }
    }

    async function sendMessage() { /* ... same as before ... */ }

    // EVENT LISTENERS (Updated)
    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    newChatBtn.addEventListener('click', startNewChat);

    // UPDATED chatHistoryEl listener to handle both switching and deleting
    chatHistoryEl.addEventListener('click', (e) => {
        const deleteButton = e.target.closest('.delete-chat-btn');
        if (deleteButton) {
            e.stopPropagation(); // Prevent chat from switching when deleting
            const chatId = deleteButton.dataset.chatId;
            deleteChat(chatId);
            return;
        }

        const chatItem = e.target.closest('.chat-history-item');
        if (chatItem) {
            const chatId = chatItem.dataset.chatId;
            switchChat(chatId);
        }
    });

    suggestionCards.forEach(card => { /* ... same as before ... */ });

    themeToggle.addEventListener('click', () => { /* ... same as before ... */ });

    // UPDATED Mobile Menu Toggle logic
    function toggleSidebar() {
        sidebar.classList.toggle('open');
        mobileOverlay.classList.toggle('active');
    }
    menuBtn.addEventListener('click', toggleSidebar);
    mobileOverlay.addEventListener('click', toggleSidebar);
    
    inputEl.addEventListener('input', () => { /* ... same as before ... */ });

    // INITIALIZATION
    if (localStorage.getItem('nedits_ai_theme') === 'light') { /* ... same as before ... */ }
    loadState();
    renderSidebar();
    renderActiveChat();

    // Pasting the full JS logic here as some functions were abbreviated "same as before"
    function saveState() {
        localStorage.setItem('nedits_ai_chats', JSON.stringify(chats));
        localStorage.setItem('nedits_ai_active_chat', activeChatId);
    }

    function loadState() {
        const savedChats = JSON.parse(localStorage.getItem('nedits_ai_chats'));
        const savedActiveId = localStorage.getItem('nedits_ai_active_chat');
        
        if (savedChats) { chats = savedChats; }

        if (savedActiveId && chats[savedActiveId]) {
            activeChatId = savedActiveId;
        } else if (Object.keys(chats).length > 0) {
            activeChatId = Object.keys(chats).sort((a,b) => b-a)[0];
        } else {
            startNewChat();
        }
    }

    function renderActiveChat() {
        messageListEl.innerHTML = '';
        const chatContainer = messageListEl.parentElement;
        if (activeChatId && chats[activeChatId] && chats[activeChatId].messages.length > 0) {
            emptyStateEl.style.display = 'none';
            chats[activeChatId].messages.forEach(msg => addBubble(msg.role, msg.content));
        } else {
            emptyStateEl.style.display = 'flex';
        }
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addBubble(role, content) {
        const bubble = document.createElement('div');
        bubble.className = `bubble ${role}`;
        
        const avatar = document.createElement('div');
        avatar.className = `avatar ${role}`;
        avatar.textContent = role === 'user' ? 'You' : 'N';

        const msg = document.createElement('div');
        msg.className = 'msg';
        
        msg.innerHTML = marked.parse(content);
        
        msg.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });

        bubble.appendChild(avatar);
        bubble.appendChild(msg);
        messageListEl.appendChild(bubble);
        
        messageListEl.parentElement.scrollTop = messageListEl.parentElement.scrollHeight;

        return msg;
    }
    
    function startNewChat() {
        const newChatId = Date.now().toString();
        chats[newChatId] = {
            title: 'New Conversation',
            messages: []
        };
        activeChatId = newChatId;
        renderActiveChat();
        renderSidebar();
        saveState();
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('open');
            mobileOverlay.classList.remove('active');
        }
    }

    async function sendMessage() {
        const userInput = inputEl.value.trim();
        if (!userInput || !activeChatId) return;

        inputEl.value = '';
        inputEl.style.height = 'auto';
        sendBtn.disabled = true;

        emptyStateEl.style.display = 'none';

        addBubble('user', userInput);
        chats[activeChatId].messages.push({ role: 'user', content: userInput });

        if (chats[activeChatId].messages.length === 1) {
            chats[activeChatId].title = userInput.substring(0, 30) + (userInput.length > 30 ? '...' : '');
            renderSidebar();
        }

        const aiMsgElement = addBubble('ai', '<i class="fa-solid fa-spinner fa-spin"></i>');
        let fullResponse = '';

        try {
            const historyForAPI = [
                { role: "user", parts: [{ text: SYSTEM_PROMPT }] },
                { role: "model", parts: [{ text: "Understood. I will act as Nedits AI." }] }
            ];
            chats[activeChatId].messages.forEach(msg => {
                historyForAPI.push({
                    role: msg.role === 'user' ? 'user' : 'model',
                    parts: [{ text: msg.content }]
                });
            });

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-goog-api-key': API_KEY },
                body: JSON.stringify({ contents: historyForAPI })
            });
            
            if (!response.ok) throw new Error(`API Error: ${response.status} ${response.statusText}`);

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            aiMsgElement.innerHTML = '';

            while (true) {
                const { value, done } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const jsonStr = line.substring(6);
                        try {
                            const data = JSON.parse(jsonStr);
                            const textChunk = data.candidates[0]?.content?.parts[0]?.text || '';
                            fullResponse += textChunk;
                            aiMsgElement.innerHTML = marked.parse(fullResponse + ' ▌');
                        } catch (e) {}
                    }
                }
                messageListEl.parentElement.scrollTop = messageListEl.parentElement.scrollHeight;
            }

            aiMsgElement.innerHTML = marked.parse(fullResponse);
            aiMsgElement.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
            
            chats[activeChatId].messages.push({ role: 'ai', content: fullResponse });

        } catch (error) {
            aiMsgElement.innerHTML = `Error: ${error.message}`;
        } finally {
            sendBtn.disabled = false;
            saveState();
        }
    }

    suggestionCards.forEach(card => {
        card.addEventListener('click', () => {
            inputEl.value = card.dataset.prompt;
            sendMessage();
        });
    });

    themeToggle.addEventListener('click', () => {
        const isDark = document.documentElement.dataset.theme !== 'light';
        if (isDark) {
            document.documentElement.dataset.theme = 'light';
            themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
            localStorage.setItem('nedits_ai_theme', 'light');
        } else {
            document.documentElement.removeAttribute('data-theme');
            themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
            localStorage.setItem('nedits_ai_theme', 'dark');
        }
    });

    inputEl.addEventListener('input', () => {
        inputEl.style.height = 'auto';
        inputEl.style.height = `${inputEl.scrollHeight}px`;
    });

    if (localStorage.getItem('nedits_ai_theme') === 'light') {
        document.documentElement.dataset.theme = 'light';
        themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
    }
});
</script>
</body>
</html>
